>- For each species in each system, list the numbers of hatchery and wild tags going out and the timing of those detections (to be able to compare hatchery and wild outmigrations).

>- For each stage (i.e. hatchery/river, estuary, microtroll, adult), what are the number of tags deployed to date or over a specific time frame? 

>- For each system/watershed, list all tags deployed that were subsequently redetected on the lowest mainstem array or in the estuary (to look at freshwater survival).

>- For each species in each system/watershed, list the fork lengths of the fish tagged and identify which of those fish were detected as returning adults (compare size structure of initial and returning cohorts).

>- For each system each year, look up what proportion of the total tags out were detected on seal haul outs or in heron rookeries (to be able to easily pull out predator data and calculate predation rates). 

>- A query to produce a data frame that could be used for overwinter survival analysis for Chinook: This data frame would include all Chinook to which a tag had been applied during microtrolling events at the time of original tagging. It should not include mortalities, recaps, etc. I think this query is useful to illustrate a general question…. To what extent should derived attributes be coded in SQL to facilitate direct queries vs being generated on a case by case basis in downstream analyses. 
>
>For this (and most other) analyses we would need to include the outmigration year, for microtroll fish this is a derived attribute (for other periods, like beach seining and hatchery releases it can generally be assumed) . Outmigration year comes from the year class of the fish and the study year, the study year in turn can be derived from the capture date, while the year class is derived from the capture date and the fork length, or alternatively could be derived from the PBT-based brood year, these assignments are currently done in the code that generates microgen…. I guess one of the questions we need to address is whether processes to generate such derived attributes should be formalized in SQL so that outmigration year (for example) could be included directly in a query…. Or whether queries should just be for raw data and derived attributes should be generated in downstream analyses. 
>
>The dataframe should include attributes of the day and event that would be needed for survival analysis. This would include date (which would be converted to Day of Year for modeling), project (to compare survival across BCCF, UVic and Volunteer), and study year. There are other attributes that could be useful (for example crew which would allow us to look for possible survival patterns linked to specific people, spatial variables-lat and long for the set, water temperature etc.). Exactly what attributes are needed requires more thought. 
The dataframe should include fish attributes that would be needed for survival analysis. These would include stock, year class (see a), capture injury, previous injury, signs and symptoms, genetic sex, and fork length. In future other analyses with UVic data might include additional variables such as condition (derived from length and weight) or gene expression data from gill biopsy FIT CHIP results. 
>
>For modeling we will likely need a “relative size” metric… basically is a fish big or small….  I am not quite sure what this will look like yet. We likely cannot include size directly in a survival model as it is confounded with day of year (which would be the key predictor for modeling). One option could be to build a fork length by date model and then use residuals from this model as a “relative size” metric. Exactly what such a model would look like still needs thought. This could be a non-linear (generalized additive) hierarchical model with a global relationship between date and fork length and then stock and/or region and/or year specific nonlinear deviations from this global relationship. Analyses might also want to look at alternative relative size metrics…. This is another example of something which could either be coded in SQL or could be downstream in analysis. I guess the question is would we want to be able to query the database for a “relative size” attribute.
>
>The response variable here would be binomial, a fish either survives to adulthood (1), or does not (0). Given that these are microtroll fish we know that any tag that is detected in a river would be considered a survivor. But it would also be good to have the river of return included so fish could be qualified as returning their own river or being strays. This will be a general comment on survival queries… where we want to compare our PIT based survival data to survival data from other methods we want to include only returns to river of origin (this would be defined as cases where the stock assigned by GSI matched the river of return)… however, for broader analyses (like this over winter analysis) we would want to include fish detected in other rivers as well (as we know they survived). Note that an added wrinkle here is whether to set a minimum threshold for stock ID probability that would lead a fish to be considered to belong to one stock or not.  We would also want this query to look for microtroll tags in cleaning table scans and avid angler recap detections (or any other future data streams where adult fish are scanned). If a tag shows up in any adult fish it can be considered to survive to adulthood. I can see us running analyses that included only fish returning to home rivers, fish returning to all rivers, and fish returning to all rivers or detected anywhere as adults (such as cleaning tables). 
>
>Another derived attribute for fish returning to rivers would be the age at return. This would be derived from the year class (in turn derived as described in a), tagging date, and return date. This is another case where we need to think about what processing is done within the data management framework vs outside. Age at return will be important for all analyses… so should we be doing this downstream or should we be able to query the database for age at return directly. 
>
>A further derived attribute will be origin (hatchery vs wild).  This will be derived from interactions of a number of other attributes. For example - Cowichan Chinook - we may be able to assume that all unclipped fish are wild… but this is year dependent as not all hatchery fish are clipped in some years (also see 12f).


>- The “Stage specific survival” Query: This would be the query needed to fit a stage specific survival model for an individual stock. In the case of a multistock model the query would be the same, but more than one stock would be selected. In a typical CJS-type survival model the data format required would be a matrix where each row is a tag and each column is an event or period. If a fish is tagged or recovered during that event or period the matrix value is 1, otherwise it is zero. I am unsure if we will need data in this format for the modeling we will do, but I can imagine that at least we will need a precursor format. This would be a single row for each time a tag was encountered (applied, recaptured, or detected in-river. A tag might have only a single event (tagging) or multiple events. This is another case where many of the key attributes are derived. Necessary attributes would be 
Stock, this is a key attribute to be able to query, but it is not in the raw data (needs to be assigned). This is currently done in the tagging data assembly script but likely would need to be formalized in SQL. So, for example, a chinook tagged at the RST in Cowichan is assumed to be a Cowichan fall Chinook. At Nanaimo there are two different hatchery tagging groups of known stock (Nanaimo fall and Nanaimo summer). Such stock assignments are somewhat different than the genetic stock assignment by GSI. We know the stock of a fish based on where we found it rather than assigning it probabilistically. This is similar to PBT assignments for estuary or microtrolling where we know the stock of a fish because of who its parents were. For GSI based stock assignments we would likely need to include the probability of belonging to stock attribute here as we might want to set a probability threshold in our analyses.
>
>Outmigration year will be a key variable as this is the temporal unit by which we will conduct survival analysis, see discussion under 11a above.
>
>I think we may need a “period” or “event” variable if we are looking at this in a CJS framework. We would need to think a little bit about what these periods are. Hatchery tagging is simple, but what about RST (in river) vs estuary tagging, are these the same “period?” I think a smolt trap would be the same period as an RST. For microtrolling there is also the question of whether we might derive period based on date by aggregating into one, two or three tagging blocks; further we would likely separate fish in their first and second ocean winter as these are not the same period from a life history point of view. A very draft form of this is currently done in tagging data assembly. 
>
>We will need a “date” for the event. This is very straight-forward for fish captured in the wild. For hatchery tags we will need to decide whether tagging date or release data is the event date for survival analysis. As I believe we are able to censor mortalities prior to release I suspect that release date is most appropriate. For detections in-river the date is a bit more complex. We need to decide whether to count the first in-river detection or last in river detection as the return date. If counting first detection (probably most appropriate and will also avoid cases of carcasses washing out) we need some filters or processing to ensure the detection is of a returning fish. These would include elapsed time since release, time of year, direction (if available), and possibility relation to flow events (which could dislodge and move bedload tags). This processing will in some cases be system, stock, and species specific. 
>
>We would likely need a detection efficiency attribute to assign to each in-river detection. I am unsure how we will end up including this in the survival analysis but it will definitely be necessary in some form. Basically elsewhere we will be calculating detection efficiency for each species, stock, origin (hatchery vs wild) and return year. In some cases this detection efficiency might be non-stationary during the season as well. 


>- Origin (Hatchery vs wild): This is implied for fish tagged in the hatchery, but will need to be assigned for fish captured in the wild (RST, microtroll, beach seine see also 11g). Determination will be based on a variety of interacting variables (e.g. we can assume that all fish capture by beach seining prior to the hatchery release data for a given system are wild, after release we know that all clipped fish and all fish assigned by PBT are hatchery, we may or may not be able to assume that unclipped fish that are assigned by GSI are wild, further discussions on this are required.)
>
>We may wish to include other variables in the analysis that relate to a specific stage. The most obvious would be relative size for microtrolling and wild tagging (see 11d). We could also want to include injuries for microtroll fish, or perhaps environmental variables (flow?) for hatchery releases. I am not sure at this time what this would look like. 
